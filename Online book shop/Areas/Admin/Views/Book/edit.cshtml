@model Online_book_shop.Models.ViewModel.BookVM
@using Online_book_shop.Models;
@using Online_book_shop.Models.ViewModel;
@using Online_book_shop.Handlers.Helper;
@using Online_book_shop.Handlers.Business;
@using Newtonsoft.Json;

@{
    ViewBag.Title = "Edit Book |" + Model.Title;
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<string> Obj_book_property_types = ViewBag.book_property_types;
    List<DataObjVM> data = ViewBag.list;
}
<script src="https://cdn.ckeditor.com/4.14.1/standard/ckeditor.js"></script>
<h2>Edit Book/ Edit Book Pack | @Model.Title</h2>
<form id="form-add-book" method="post" action="/Admin/Book/edit" enctype="multipart/form-data">
    <input type="hidden" value="@Model.Id" name="Id" />
    <div class="row col-lg-12 col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                Basic Details
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" value="@Model.Title" class="form-control" id="Title" name="Title" placeholder="Title">
                </div>
                <div class="form-group">
                    <label>Title(Sinhala)</label>
                    <input type="text" value="@Model.LocalTitle" class="form-control" id="LocalTitle" name="LocalTitle" placeholder="Title(Sinhala)">
                </div>
                <div class="form-group">
                    <label>ISBN / Book Pack ID</label>
                    <input type="text" value="@Model.ISBN" class="form-control" id="ISBN" name="ISBN" placeholder="ISBN" />
                </div>
                <div class="form-group">
                    <label>Categories</label>
                    <div class="col-lg-12">
                        @{ var selectedCategories = !string.IsNullOrEmpty(Model.Categories) ? Model.Categories.Split(',') : null;
                            foreach (Category c in ViewBag.Categories)
                            {
                <div class="col-lg-4">
                    <div class="input-group-prepend">
                        <div class="input-group-text category-check-box-container">
                            @if (selectedCategories != null)
                            {
                                if (selectedCategories.ToList().Contains(c.Id.ToString()))
                                {
            <input type="checkbox" style="width: 30px;height: 30px;margin-left: -30px;z-index:100;" checked class="category-check-box" aria-label="Checkbox for following text input" value="@c.Id"><span>@c.CategoryName</span>
                                    <span class="checkmark"></span> }
                                else
                                {
            <input type="checkbox" style="width: 30px;height: 30px;margin-left: -30px;z-index:100;" class="category-check-box" aria-label="Checkbox for following text input" value="@c.Id"><span>@c.CategoryName</span>
                                    <span class="checkmark"></span> }

                            }
                            else
                            {
            <input type="checkbox" style="width: 30px;height: 30px;margin-left: -30px;z-index:100;" class="category-check-box" aria-label="Checkbox for following text input" value="@c.Id"><span>@c.CategoryName</span>
                                <span class="checkmark"></span>}
                        </div>
                    </div>

                </div> } }

                        <input type="hidden" id="Categories" name="Categories" value="@Model.Categories" />
                    </div>

                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea type="text" class="form-control" id="Description" name="Description" placeholder="Description">@Model.Description</textarea>
                    <script>
                        CKEDITOR.replace('Description');
                    </script>
                </div>
                <div class="form-group">
                    <label>You Tube Vedio</label>
                    <input type="text" class="form-control" id="YoutubeUrl" value="@Model.YoutubeUrl" name="YoutubeUrl" placeholder="Youtube Url">
                </div>

                @if (Model.ItemType == (int)ItemType.Book)
                {
    <div class="form-group">
        <label>Publisher<span class="text-success refresh-publishers" style="cursor:pointer;"><i class="fa fa-refresh" aria-hidden="true"></i></span></label>
        <select id="PublisherId" class="form-control" name="PublisherId">
            @foreach (Publisher publisher in ViewBag.Publishers)
            {
                if (Model.PublisherId == publisher.Id)
                {
<option selected value="@publisher.Id">@publisher.Name</option> }
                    else
                    {
<option value="@publisher.Id">@publisher.Name</option>}
                }
        </select>

    </div>}

                <div class="form-group  author-block">
                    <label>Author<span class="text-success refresh-authors" style="cursor:pointer;"></span></label>
                    <div class="select  main-author-block">
                        <select id="AuthorId" class="form-control" name="AuthorId">
                            @foreach (Author author in ViewBag.Authors)
                            {
                                if (Model.AuthorId == author.Id)
                                {
                <option selected value="@author.Id">@author.Name</option> }
                                else
                                {
                <option value="@author.Id">@author.Name</option>}
                            }
                        </select>
                    </div>
                    @{ //List<Author> authors = BusinessHandlerAuthor.GetmultipleAuthors(Model.Id);
                        foreach (int i in Model.OtherAthors)
                        {
                            Author a = BusinessHandlerAuthor.GetAuthorById(i);
            <span class="col-lg-3">@a.LocalName</span><span data-book-id="@Model.Id" data-author-id="@a.Id" class="remove-multiple-author btn btn-sm btn-danger">Remove</span> }
<span class="btn btn-xs add-more-author">Add more</span> }


                </div>
                <div class="form-group">
                    <label>Language</label>
                    <select id="LanguageId" class="form-control" name="LanguageId">
                        @foreach (Language l in ViewBag.Languages)
                        {
                            if (l.Id == Model.LanguageId)
                            {
            <option selected value="@l.Id">@l.Name</option> }
                            else
                            {
            <option value="@l.Id">@l.Name</option>}
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label>Sale Type</label>
                    <select id="SaleType" class="form-control" name="SaleType">
                        @if (ViewBag.SaleStatus != null)
                        {
                            List<SaleStatus> saleStatuses = ViewBag.SaleStatus;
                            foreach (SaleStatus s in saleStatuses)
                            {
                                if (Model.SaleType == s.Id)
                                {
            <option selected value="@s.Id">@s.DisplayText</option> }
                                else
                                {
            <option value="@s.Id">@s.DisplayText</option>
}
    }
}
                    </select>
                </div>
                <div class="form-group">
                    <label id="lbl-pre-release-end-date">@(Model.ItemType == (int)ItemType.Book?"Pre Release End Date":"Book pack available until")</label>
                    <input type="text" value="@Model.PreReleaseEndDate" class="form-control" id="PreReleaseEndDate" name="PreReleaseEndDate" placeholder="Pre Release End Date">
                </div>
                <div class="form-group">
                    <label>Free Read Content</label>
                    <input type="file" class="form-control-file" id="FreeReadPDFMedia" name="FreeReadPDFMedia">
                    @if (Model.ReadPDF != null)
                    {
        <a target="_blank" href="~/Content/UploadFiles/PDF/@Model.ReadPDF.FileName"><label>@Model.ReadPDF.FileName</label></a>}
                </div>
                <div class="form-group">
                    <label>Front Cover</label>
                    <input type="file" class="form-control-file bk_front_img" id="FrontCoverMedia" name="FrontCoverMedia">
                    <div>
                        <img id="temp_img_bk_front_img" style="height:100px;" class="img-thumbnail" src="~/Content/images/NoImage.jpg" alt="Profile Image" />
                    </div>
                    @if (Model.FrontCover != null && HTMLHelper.isImageExist("Content/UploadFiles/Images/BookFrontCover/" + Model.FrontCover.FileName))
                    {
        <div class="div-square">
            <img src="@Url.Action("ResizeImage", "AdminUtility", new {FileName="~/Content/UploadFiles/Images/BookFrontCover/"+Model.FrontCover.FileName,width=67,height=102})" height="100" alt="" />
            @*<img src="~/Content/UploadFiles/Images/BookFrontCover/@Model.FrontCover.FileName" width="100" />*@
        </div> }
    else
    {
<div class="div-square">
    <i class="fa fa-book fa-5x"></i>
</div>}

                </div>
                <div class="form-group">
                    <label>Back Cover</label>
                    <input type="file" class="form-control-file bk_back_img" id="BackCoverMedia" name="BackCoverMedia">
                    <div>
                        <img id="temp_img_bk_back_img" style="height:100px;" class="img-thumbnail" src="~/Content/images/NoImage.jpg" alt="Profile Image" />
                    </div>
                    @if (Model.BackCover != null && HTMLHelper.isImageExist("Content/UploadFiles/Images/BookBackCover/" + Model.BackCover.FileName))
                    {
        <img src="@Url.Action("ResizeImage", "AdminUtility", new {FileName="~/Content/UploadFiles/Images/BookBackCover/"+Model.BackCover.FileName,width=67,height=102})" height="100" alt="" /> @*<img src="~/Content/UploadFiles/Images/BookBackCover/@Model.BackCover.FileName" width="100" />*@ }
    else
    {
<div class="div-square">
    <i class="fa fa-book fa-5x"></i>
</div>}

                </div>
                <div class="form-group">
                    <label class="control-label">Upload other images</label>
                    <input type="file" id="image_files" name="image_files[]" multiple />
                    <div class="col-lg-12">
                        @{ List<ItemMedia> otherImages = BusinessHandlerBook.GetOtherMedia(Model.Id, ObjectTypes.Book);
                            if (otherImages != null)
                            {
                                foreach (ItemMedia im in otherImages)
                                {
                                    Media m = BusinessHandlerMedia.Get(im.MediaId);
                                    if (m != null)
                                    {
                <div class="col-lg-2" style="margin:5px;">
                    <img src="@Url.Action("ResizeImage", "AdminUtility", new {FileName="~/Content/UploadFiles/Images/CoverImage/"+m.FileName,width=67,height=102})" height="100" alt="" />
                    <button class="btn btn-danger btn-sm rmv-media" data-item-media-id="@im.Id" data-book-id="@Model.Id" data-item-type="book">Remove</button>
                </div> }
        }
    } }
                    </div>

                </div>
                <div class="form-group">
                    <label>Rating</label>
                    <input value="@Model.Ratings" type="number" min="0" max="5" class="form-control" id="Ratings" name="Ratings" placeholder="Ratings" />
                </div>
                <div class="form-group">
                    <label>Maximum Number Of Items Per Cart</label>
                    <input type="number" min="0" value="@Model.MaximumItemPerOrder" class="form-control" id="MaximumItemPerOrder" name="MaximumItemPerOrder" placeholder="Maximum Item PerOrder" />
                </div>
            </div>

        </div>
    </div>
    @if (Model.ItemType == (int)ItemType.Book)
    {
<input value="0" type="hidden" name="ItemType"> for (int i = 0; i < 5; i++)
                {
                    if (Model.BookProperties.Count > i)
                    {
                        BookPropertyVM VM = Model.BookProperties[i];
                        string style = (VM.Id > 0 ? "display: block;" : "display: none;");
<div class="row col-lg-12 col-md-12 b-prop-@(i + 1)" style="@style">
    <div class="panel panel-default">
        <div class="panel-heading">
            Type of books
        </div>
        <div class="panel-body">
            <div class="col-lg-6" style="border-right:solid 1px;">
                <h3 class="mini-header">Base Property</h3>
                <hr />
                <div class="form-group">
                    <label>Property Title</label>
                    <div class="select">
                        <select id="BookProperties[@i].Title" name="BookProperties[@i].Title" class="form-control">
                            @foreach (var item in Obj_book_property_types)
                            {
    <option @(VM.Title == item ? "selected" : "") value="@item">@item</option>
}

                            @*<option value="Hard Bind Cover">Hard Bind Cover</option>
                                <option value="Other">Other</option>*@
                        </select>
                    </div>
                    @*<input type="text" value="@VM.Title" class="form-control" id="BookProperties[@i].Title" name="BookProperties[@i].Title" placeholder="Title">*@
                </div>
                <div class="form-group hidden">
                    <label>Property Description</label>
                    <textarea type="text" class="form-control" id="BookProperties[@i].Description" name="BookProperties[@i].Description" placeholder="Description">@VM.Description</textarea>
                </div>
                <div class="form-group">
                    <label>Number Of Pages</label>
                    <input type="number" value="@VM.NumberOfPages" class="form-control" id="BookProperties[@i].NumberOfPages" name="BookProperties[@i].NumberOfPages" placeholder="NumberOfPages">
                </div>
                <div class="form-group">
                    <label>Weight(One book by gram)</label>
                    <input type="number" value="@VM.WeightByGrams" class="form-control" id="BookProperties[@i].WeightByGrams" name="BookProperties[@i].WeightByGrams" placeholder="Weight By Grams">
                </div>
                <div class="form-group">
                    <label>Number Of Copies</label>
                    <input type="number" value="@VM.NumberOfCopies" class="form-control" id="BookProperties[@i].NumberOfCopies" name="BookProperties[@i].NumberOfCopies" placeholder="Number Of Copies">
                </div>
                <div class="form-group">
                    <label>Raw Price</label>
                    <input type="number" value="@VM.Price" class="form-control" id="BookProperties[@i].Price" name="BookProperties[@i].Price" placeholder="Price">
                </div>
                <input type="hidden" name="isAvailable_@i" id="isAvailable_@(i + 1)" value="@i" />
                <input type="hidden" name="BookProperties[@i].Id" id="BookProperties[@i].Id" value="@VM.Id" />
            </div>
            <div class="col-lg-6">
                <h3 class="mini-header">Quick Promotion</h3>
                <hr />
                <div class="form-group">
                    <label>Discount Value</label>
                    <table>
                        <tr>
                            <td><input type="number" min="0" class="form-control" id="DiscountValue" name="BookProperties[@i].DiscountValue" value="@VM.DiscountValue"></td>
                            <td class="col-lg-8">
                                <div class="select">
                                    <select class="form-control" name="BookProperties[@i].PromotionMethods">
                                        @if (@VM.PromotionMethods == 1)
                                        {
                <option value="1" selected>Percent</option>
 }
            else
            {
<option value="1">Percent</option>
}
                                        @if (@VM.PromotionMethods == 0)
                                        {
                <option value="0" selected>Fix Amount</option>
 }
            else
            {
<option value="0">Fix Amount</option>
}
                                    </select>
                                </div>
                            </td>
                        </tr>

                    </table>



                </div>
            </div>
        </div>
        <div class="panel-footer text-right">
            <button class="btn btn-defaultv btn-b-prop-@(i + 1)">Add New</button>
        </div>
    </div>
</div> }
else
{
    <div class="row col-lg-12 col-md-12 b-prop-@(i + 1)" style="display:none">
        <div class="panel panel-default">
            <div class="panel-heading">
                Type of books
            </div>
            <div class="panel-body">
                <div class="col-lg-6" style="border-right:solid 1px;">
                    <h4 class="mini-header">Base Property</h4>
                    <hr />
                    <div class="form-group">
                        <label>Property Title</label>
                        @*<input type="text" class="form-control" id="BookProperties[@i].Title" name="BookProperties[@i].Title" placeholder="Title">*@
                        <select id="BookProperties[@i].Title" name="BookProperties[@i].Title" class="form-control">
                            @foreach (var item in Obj_book_property_types)
                            {
    <option value="@item">@item</option>
    }
                        </select>
                    </div>
                    <div class="form-group hidden">
                        <label>Property Description</label>
                        <textarea type="text" class="form-control" id="BookProperties[@i].Description" name="BookProperties[@i].Description" placeholder="Description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Number Of Pages</label>
                        <input type="number" class="form-control" id="BookProperties[@i].NumberOfPages" name="BookProperties[@i].NumberOfPages" placeholder="NumberOfPages">
                    </div>
                    <div class="form-group">
                        <label>Weight(One book by gram)</label>
                        <input type="number" class="form-control" id="BookProperties[@i].WeightByGrams" name="BookProperties[@i].WeightByGrams" placeholder="Weight By Grams">
                    </div>
                    <div class="form-group">
                        <label>Number Of Copies</label>
                        <input type="number" class="form-control" id="BookProperties[@i].NumberOfCopies" name="BookProperties[@i].NumberOfCopies" placeholder="Number Of Copies">
                    </div>
                    <div class="form-group">
                        <label>Raw Price</label>
                        <input type="number" class="form-control" id="BookProperties[@i].Price" name="BookProperties[@i].Price" placeholder="Price">
                    </div>
                    <input type="hidden" name="isAvailable_@i" id="isAvailable_@(i + 1)" value="@i" />
                </div>
                <div class="col-lg-6">
                    <h4 class="mini-header">Quick Promotion</h4>
                    <hr />
                    <div class="form-group">
                        <label>Discount Value</label>
                        <table>
                            <tr>
                                <td><input type="number" min="0" class="form-control" id="DiscountValue" name="BookProperties[@i].DiscountValue" value="20"></td>
                                <td class="col-lg-8">
                                    <div class="select">
                                        <select class="form-control" name="BookProperties[@i].PromotionMethods">
                                            <option value="1">Percent</option>
                                            <option value="0">Fix Amount</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>

                        </table>
                    </div>
                </div>

            </div>
            <div class="panel-footer text-right">
                <button class="btn btn-defaultv btn-b-prop-@(i + 1)">Add New</button>
            </div>
        </div>
    </div> 
}
}
}
else
{
var bookProperty = Model.BookProperties.FirstOrDefault();
<input value="1" type="hidden" name="ItemType">
<div class="book-pack-container col-lg-12">
    <div class="col-lg-6">
        <div class="form-group">
            <label>Books </label>
            <table>
                <tr>
                    <td class="col-lg-6">
                        <div class="select mce-match-marker-selected book-row ">
                            <select id="select-book-for-book-pack" class="form-control " name="select-book-for-book-pack">
                                <option data-para="" class="obj_select" value="0">--Select--</option>
                                @foreach (var item in data)
                                {
                <option data-para="@item.OtherPara" class="obj_select" value="@item.Id">@item.Name</option>
}
                            </select>
                        </div>
                    </td>
                    <td class="col-lg-6">
                        <a class="btn btn-warning btn-sm  add-new-bookpackrow">Add</a>
                        <input id="numberOfBooksForBookPacks" class="display-none" type="number" value="1" />
                    </td>
                </tr>
            </table>

        </div>
        <div>
            <ul id="book-pack-menu" class="list-group">
                @if (ViewBag.selectedBooks != null)
                {
                    foreach (DataObjVM item in ViewBag.selectedBooks)
                    {
    <li data-amount="1" data-obj="@item.Id" class="list-group-item">@item.Name<span data-obj="@item.Id" class="text-danger remove-selected-book-pack-item" style="margin-left: 30px;cursor: pointer;">Remove</span></li>
}
}
            </ul>
            @{ List<string> selectedStr = new List<string>();
                foreach (DataObjVM item in ViewBag.selectedBooks)
                {
                    var obj = JsonConvert.DeserializeObject<ItemProperty>(item.OtherPara);
                    selectedStr.Add(item.Id + "-" + obj.BookPropertyId);
                } }
            <input id="selected-books" name="SelectedBooks" type="hidden" value="@string.Join(",", selectedStr)" />
        </div>
        @*<div class="form-group">
            <label>Item Price</label>
            <input type="number" class="form-control" id="item-price" value="@bookProperty.Price" name="ItemPrice" placeholder="Price">
        </div>*@
        <div class="form-group">
            <label>Number Of Copies</label>
            <input type="number" class="form-control" id="item-number-of-copies" value="@bookProperty.NumberOfCopies" name="NumberOfCopies" placeholder="Number Of Copies">
        </div>
    </div>
    <div class="col-lg-6">
        <h4 class="mini-header">Quick Promotion</h4>
        <hr />
        <div class="form-group">
            <label>Discount Value</label>
            <table>
                <tr>
                    <td><input type="number" min="0" class="form-control" id="DiscountValue" name="BookProperties[0].DiscountValue" value="20"></td>
                    <td class="col-lg-8">
                        <div class="select">
                            <select class="form-control" name="BookProperties[0].PromotionMethods">
                                <option value="1">Percent</option>
                                <option value="0">Fix Amount</option>
                            </select>
                        </div>
                    </td>
                </tr>

            </table>
        </div>
    </div>

</div>
    }


    <button type="submit" class="btn btn-primary float-right">Submit</button>
</form>




<div>
    @Html.ActionLink("Back to List", "Index")
</div>
