@using Online_book_shop.Models.ViewModel;
@using Newtonsoft.Json;
@using Online_book_shop.Models;
@{
    ViewBag.Title = "BulkPromotion";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<DataObjVM> list = ViewBag.Items;
    List<Author> Authors = ViewBag.Authors;
}
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<div class="panel panel-danger">
    <div class="panel-heading">
        Promotion Details
    </div>
    <div class="col-lg-12 panel-body" style="border: solid 1px;border-radius: 5px;padding: 20px;">

        <div class="form-group row col-lg-4">
            <label class="col-sm-4 col-form-label">Start</label>
            <div class="col-sm-8">
                <input type="date" placeholder="2021-08-12" class="form-control-plaintext" id="startDate" value="@DateTime.Today.ToString("yyyy-M-d")">
            </div>
        </div>
        <div class="form-group row  col-lg-4">
            <label class="col-sm-4 col-form-label">End</label>
            <div class="col-sm-8">
                <input type="date" placeholder="2021-08-12" class="form-control-plaintext" id="endDate" value="@DateTime.Today.AddMonths(1).ToString("yyyy-M-d")">
            </div>
        </div>
        <div class="form-group row  col-lg-4">
            <label class="col-sm-4 col-form-label">Percentage</label>
            <div class="col-sm-8">
                <input type="number" min="0" max="100" placeholder="20%" class="form-control-plaintext" id="percentage" value="20">
            </div>
        </div>
        <button class="btn btn-primary float-right btn-bulk-update-promotion">Add</button>
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="alert alert-danger col-lg-12" role="alert">
            This promotion will apply all selected books and automatically unapplicable all other configured promotion for selected books.</label>
        </div>
    </div>    
</div>
<div class="col-lg-12 panel-body" >
    <div class="col-lg-1">
        <label>Filter By  Author</label>
    </div>

    <div class="select col-lg-3">
        <select class="form-control" id="select-author">
            @{
                int selected_author = 0;
                if (!string.IsNullOrEmpty(Request.QueryString["author"]))
                {
                    selected_author = Convert.ToInt32(Request.QueryString["author"]);
                }
            }
            <option value="0" @(selected_author == 0 ? "selected" : "")>--All Author--</option>
            @foreach (Author author in Authors)
            {
                <option value="@author.Id" @(selected_author == author.Id ? "selected" : "")>@author.Name</option>
            }

        </select>
        @*<button class="btn btn-warning btn-sm filter-books-by-author">Filter</button>*@
    </div>
    <div class="col-lg-4">
        
    </div>
</div>
       
        

<div class="col-lg-12">
    
    <div class="col-lg-6">
        <h3>Normal Covers</h3>
        <div class="form-check">
            <input name="product_all" class="form-check-input  checked_all" type="checkbox" value="" id="flexCheckIndeterminate">
            <label class="form-check-label" for="flexCheckIndeterminate">
                Select All
            </label>
        </div>
        @foreach (DataObjVM obj in list.Where(x => x.Name.Contains("Normal Cover")))
        {
            ItemProperty itemProperty = JsonConvert.DeserializeObject<ItemProperty>(obj.OtherPara);
            <div class="col-lg-12 author_@obj.BookAuthorId check-box-container">
                <div class="col-lg-1">
                    <input value="@obj.Id" data-author="@obj.BookAuthorId"  data-property="@itemProperty.BookPropertyId" name="product" class="checkbox checkbox-nc" type="checkbox">
                </div>
                <div class="col-lg-11">
                    @obj.Name
                </div>
            </div>
        }
    </div>
    <div class="col-lg-6">
        <h3>Hard Bind Cover</h3>
        <div class="form-check">
            <input name="product_all" class="form-check-input  checked_hard_bind_all" type="checkbox" value="" id="flexCheckIndeterminate">
            <label class="form-check-label" for="flexCheckIndeterminate">
                Select All
            </label>
        </div>
        @foreach (DataObjVM obj in list.Where(x => x.Name.Contains("Hard Bind Cover")))
        {
            ItemProperty itemProperty = JsonConvert.DeserializeObject<ItemProperty>(obj.OtherPara);
            <div class="col-lg-12 author_@obj.BookAuthorId check-box-container">
                <div class="col-lg-1">
                    <input value="@obj.Id" data-author="@obj.BookAuthorId"  data-property="@itemProperty.BookPropertyId" name="product" class="checkbox_hard_bind checkbox-hb" type="checkbox">
                </div>
                <div class="col-lg-11">
                    @obj.Name
                </div>
            </div>
        }

        @if (list.Where(x => !(x.Name.Contains("Hard Bind Cover") || x.Name.Contains("Normal Cover"))) != null && list.Where(x => !(x.Name.Contains("Hard Bind Cover") || x.Name.Contains("Normal Cover"))).Count() > 0)
        {
            <h3>Other Versions</h3>
            <div class="form-check">
                <input name="product_all" class="form-check-input  checked_other_all" type="checkbox" value="" id="flexCheckIndeterminate">
                <label class="form-check-label" for="flexCheckIndeterminate">
                    Select All
                </label>
            </div>
            foreach (DataObjVM obj in list.Where(x => !(x.Name.Contains("Hard Bind Cover") || x.Name.Contains("Normal Cover"))))
            {
                ItemProperty itemProperty = JsonConvert.DeserializeObject<ItemProperty>(obj.OtherPara);
                <div class="col-lg-12 author_@obj.BookAuthorId check-box-container">
                    <div class="col-lg-1">
                        <input value="@obj.Id" data-author="@obj.BookAuthorId"  data-property="@itemProperty.BookPropertyId" name="product" class="checkbox_other checkbox-ov" type="checkbox">
                    </div>
                    <div class="col-lg-11">
                        @obj.Name
                    </div>
                </div>
            }
        }
    </div>
</div>

<script type="text/javascript">
    $('.checked_all').on('change', function () {
        $('.checkbox').prop('checked', $(this).prop("checked"));
    });
    //deselect "checked all", if one of the listed checkbox product is unchecked amd select "checked all" if all of the listed checkbox product is checked
    $('.checkbox').change(function () { //".checkbox" change
        if ($('.checkbox:checked').length == $('.checkbox').length) {
            $('.checked_all').prop('checked', true);
        } else {
            $('.checked_all').prop('checked', false);
        }
    });
    $('.checked_hard_bind_all').on('change', function () {
        $('.checkbox_hard_bind').prop('checked', $(this).prop("checked"));
    });
    //deselect "checked all", if one of the listed checkbox product is unchecked amd select "checked all" if all of the listed checkbox product is checked
    $('.checkbox_hard_bind').change(function () { //".checkbox" change
        if ($('.checkbox_hard_bind:checked').length == $('.checkbox_hard_bind').length) {
            $('.checked_hard_bind_all').prop('checked', true);
        } else {
            $('.checked_hard_bind_all').prop('checked', false);
        }
    });
    $('.checked_other_all').on('change', function () {
        $('.checkbox_other').prop('checked', $(this).prop("checked"));
    });
    //deselect "checked all", if one of the listed checkbox product is unchecked amd select "checked all" if all of the listed checkbox product is checked
    $('.checkbox_other').change(function () { //".checkbox" change
        if ($('.checkbox_other:checked').length == $('.checkbox_other').length) {
            $('.checked_other_all').prop('checked', true);
        } else {
            $('.checked_other_all').prop('checked', false);
        }
    });
</script>

